
<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Minecraft 3D Prototype</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; color:white; }
    #info { position:absolute; top:10px; left:10px; font-family:monospace; background:rgba(0,0,0,0.5); padding:5px; }
  </style>
</head>
<body>
<div id="info">WASD - mișcare | Space x2 - fly | Shift - jos | C - ieși fly | F - setări | Esc - pauză | Qx2 - ieșire | Click - bloc</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);
let camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// Lumină
let sun = new THREE.DirectionalLight(0xffffff, 1);
sun.position.set(10,10,5);
sun.castShadow = true;
scene.add(sun);
scene.add(new THREE.AmbientLight(0x404040));

// Teren
let terrainGeo = new THREE.BoxGeometry(1,1,1);
for(let x=-10;x<10;x++){
  for(let z=-10;z<10;z++){
    let mat = new THREE.MeshLambertMaterial({color:0x228B22});
    let cube = new THREE.Mesh(terrainGeo, mat);
    cube.position.set(x,-1,z);
    cube.castShadow = true;
    cube.receiveShadow = true;
    scene.add(cube);
  }
}

let raycaster = new THREE.Raycaster();
let mouse = new THREE.Vector2();
let flyMode = false;
let pause = false;
let settings = false;
let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();
let key = {};
let lastQ = 0;

// Cameră
camera.position.set(0,2,5);
document.addEventListener('keydown',e=>{
  if(e.code==='KeyQ'){
    if(Date.now()-lastQ<400) window.close(); // dublu Q iese
    lastQ=Date.now();
  }
  if(e.code==='Escape') pause=!pause;
  if(e.code==='KeyF') settings=!settings;
  if(e.code==='Space'){
    if(!key.SpaceLast){ 
      if(Date.now()-(key.SpaceTime||0)<300){ flyMode=true; } 
      key.SpaceTime=Date.now();
    }
    key.SpaceLast=true;
  }
  if(e.code==='KeyC') flyMode=false;
  key[e.code]=true;
});
document.addEventListener('keyup',e=>{ key[e.code]=false; if(e.code==='Space') key.SpaceLast=false; });

// Click pentru blocuri
document.addEventListener('mousedown',e=>{
  if(pause)return;
  mouse.x = (e.clientX / innerWidth) * 2 - 1;
  mouse.y = -(e.clientY / innerHeight) * 2 + 1;
  raycaster.setFromCamera(mouse, camera);
  const intersects = raycaster.intersectObjects(scene.children);
  if(intersects.length>0){
    const hit = intersects[0];
    if(e.button===0){ // stânga = adaugă bloc
      let newBlock = new THREE.Mesh(terrainGeo, new THREE.MeshLambertMaterial({color:0x8B4513}));
      newBlock.position.copy(hit.point).add(hit.face.normal).floor().addScalar(0.5);
      newBlock.castShadow=true;
      newBlock.receiveShadow=true;
      scene.add(newBlock);
    }
    if(e.button===2){ // dreapta = șterge bloc
      hit.object.geometry.dispose();
      hit.object.material.dispose();
      scene.remove(hit.object);
    }
  }
});
document.addEventListener('contextmenu',e=>e.preventDefault());

// Mișcare
function updateMovement(dt){
  if(pause)return;
  direction.set(0,0,0);
  if(key['KeyW']) direction.z-=1;
  if(key['KeyS']) direction.z+=1;
  if(key['KeyA']) direction.x-=1;
  if(key['KeyD']) direction.x+=1;
  direction.normalize();

  let speed = flyMode ? 10 : 5;
  velocity.x = direction.x * speed * dt;
  velocity.z = direction.z * speed * dt;
  camera.position.x += velocity.x * Math.cos(camera.rotation.y) - velocity.z * Math.sin(camera.rotation.y);
  camera.position.z += velocity.x * Math.sin(camera.rotation.y) + velocity.z * Math.cos(camera.rotation.y);

  if(flyMode){
    if(key['Space']) camera.position.y += speed*dt;
    if(key['ShiftLeft']) camera.position.y -= speed*dt;
  }
}

// Rotire mouse
let yaw=0, pitch=0;
document.body.requestPointerLock = document.body.requestPointerLock || document.body.mozRequestPointerLock;
document.body.onclick = ()=>{ if(!pause) document.body.requestPointerLock(); };
document.addEventListener('mousemove', e=>{
  if(document.pointerLockElement===document.body && !pause){
    yaw -= e.movementX*0.002;
    pitch -= e.movementY*0.002;
    pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));
    camera.rotation.set(pitch,yaw,0);
  }
});

// Animație
let lastTime = performance.now();
function animate(){
  requestAnimationFrame(animate);
  let now = performance.now();
  let dt = (now-lastTime)/1000;
  lastTime=now;
  updateMovement(dt);
  renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
